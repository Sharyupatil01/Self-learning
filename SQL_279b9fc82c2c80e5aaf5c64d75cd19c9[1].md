# SQL

1. Combine two tables  [https://leetcode.com/problems/combine-two-tables/description/](https://leetcode.com/problems/combine-two-tables/description/)
2. Delete duplicates email  [https://leetcode.com/problems/delete-duplicate-emails/description/](https://leetcode.com/problems/delete-duplicate-emails/description/)

```sql
DELETE FROM Person
WHERE Id NOT IN (
    SELECT MIN(Id)
    FROM Person
    GROUP BY Email
);

by joins 
DELETE p1
FROM Person p1
JOIN Person p2
ON p1.Email = p2.Email AND p1.Id > p2.Id;

```

1. Duplicate emails [https://leetcode.com/problems/duplicate-emails/description/](https://leetcode.com/problems/duplicate-emails/description/)

```sql
select email as Email 
from Person 
group by email 
having count(email)>1;

#WHERE cannot be used with COUNT() â†’ must use HAVING.
```

4  . Customers who never ordered 

```sql
#left join + is null 
select c.name as Customers 
from Customers as c 
left join  Orders as o 
on c.id = o.customerId
where o.customerId is null
order by c.name desc;
```

5 . Second highest salary   [https://leetcode.com/problems/second-highest-salary/](https://leetcode.com/problems/second-highest-salary/)

```sql
# Write your MySQL query statement below
select (
select distinct salary 
from Employee 
order by salary desc
limit 1 offset 1
)
as SecondHighestSalary;

select salary from employee order by salary desc limit 1 offset 1 
# here it will give the second highest 
# but what if the table have only 1 salary 
# then it should show null there hence sub query is used 
```

1. Highest Salary with name from each department 

```sql
# Write your MySQL query statement below
select d.name as Department , e.name as Employee ,e.salary as Salary 
from Employee as e 
join Department as d 
on e.departmentId=d.id 
where e.salary=(
     select max(salary)
     from Employee 
     where departmentId=e.departmentId
);

```

1. Rank Scores (Window Function) 

```sql
# Write your MySQL query statement below
select score ,
  dense_rank() over(order by score desc)
   as 'Rank' from Scores;
```

1. Employee earning more than manager 

```sql
# Write your MySQL query statement below
select e.name as Employee from Employee e 
left join Employee m 
on e.managerId=m.id 
where e.salary > m.salary;
```

1. nth highest salary  [https://leetcode.com/problems/nth-highest-salary/description/](https://leetcode.com/problems/nth-highest-salary/description/)

```sql

CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
SET N=N-1;#Important 
  RETURN (
      SELECT DISTINCT(Salary) 
      FROM Employee
      ORDER BY Salary DESC
      LIMIT 1 OFFSET N # (n-1) is not allowed here 
  );
END
```